<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Class: Vincenty
  
    &mdash; vincenty
  
</title>

  <link rel="stylesheet" href="css/style.css" type="text/css" />

  <link rel="stylesheet" href="css/common.css" type="text/css" />

<script type="text/javascript">
  pathId = "Vincenty";
  relpath = '';
</script>


  <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="_index.html">Index (V)</a> &raquo;
    
    
    <span class="title">Vincenty</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><h1>Class: Vincenty
  
  
  
</h1>
<div class="box_info">
  
  <dl>
    <dt>Inherits:</dt>
    <dd>
      <span class="inheritName"><span class='object_link'><a href="Coordinate.html" title="Coordinate (class)">Coordinate</a></span></span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next"><span class='object_link'><a href="Coordinate.html" title="Coordinate (class)">Coordinate</a></span></li>
          
            <li class="next">Vincenty</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
    </dd>
  </dl>
  

  
  
  
  
  

  

  
  <dl>
    <dt>Defined in:</dt>
    <dd>lib/vincenty.rb</dd>
  </dl>
  
</div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    
<p>Vincenty&#39;s algorithms for finding the bearing and distance between two coordinates and for finding the latitude and longitude, given a start coordinate, distance and bearing.</p>

<p>Coded from formulae from Wikipedia <a href="http://en.wikipedia.org/wiki/Vincenty%27s_formulae">en.wikipedia.org/wiki/Vincenty%27s_formulae</a> Modified to incorporate corrections to formulae as found in script on <a href="http://www.movable-type.co.uk/scripts/LatLongVincenty.html">www.movable-type.co.uk/scripts/LatLongVincenty.html</a> Added my Modification of the distanceAndAngle formulae to correct the compass bearing.</p>


  </div>
</div>
<div class="tags">
  

</div>
  
    <h2>
      Constant Summary
      <small><a href="#" class="constants_summary_toggle">collapse</a></small>
    </h2>

    <dl class="constants">
      
        <dt id="VERSION-constant" class="">VERSION =
          
        </dt>
        <dd><pre class="code"><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>1.0.10</span><span class='tstring_end'>&#39;</span></span></pre></dd>
      
        <dt id="WGS84_ER-constant" class="">WGS84_ER =
          <div class="docstring">
  <div class="discussion">
    
<p>Equatorial Radius of earth</p>


  </div>
</div>
<div class="tags">
  

</div>
        </dt>
        <dd><pre class="code"><span class='int'>6378137</span></pre></dd>
      
        <dt id="WGS84_IF-constant" class="">WGS84_IF =
          <div class="docstring">
  <div class="discussion">
    
<p>Inverse Flattening</p>


  </div>
</div>
<div class="tags">
  

</div>
        </dt>
        <dd><pre class="code"><span class='float'>298.257223563</span></pre></dd>
      
        <dt id="GRS80_ER-constant" class="">GRS80_ER =
          <div class="docstring">
  <div class="discussion">
    
<p>Equatorial Radius of earth</p>


  </div>
</div>
<div class="tags">
  

</div>
        </dt>
        <dd><pre class="code"><span class='int'>6378137</span></pre></dd>
      
        <dt id="GRS80_IF-constant" class="">GRS80_IF =
          <div class="docstring">
  <div class="discussion">
    
<p>Inverse Flattening</p>


  </div>
</div>
<div class="tags">
  

</div>
        </dt>
        <dd><pre class="code"><span class='float'>298.25722210882711</span></pre></dd>
      
    </dl>
  






  <h2>Instance Attribute Summary</h2>
  
  <h3 class="inherited">Attributes inherited from <span class='object_link'><a href="Coordinate.html" title="Coordinate (class)">Coordinate</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="Coordinate.html#altitude-instance_method" title="Coordinate#altitude (method)">#altitude</a></span>, <span class='object_link'><a href="Coordinate.html#latitude-instance_method" title="Coordinate#latitude (method)">#latitude</a></span>, <span class='object_link'><a href="Coordinate.html#longitude-instance_method" title="Coordinate#longitude (method)">#longitude</a></span></p>


  
    <h2>
      Instance Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#destination-instance_method" title="#destination (instance method)">#<strong>destination</strong>(track_and_distance)  &#x21d2; Vincenty </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Calculate destination point given start point lat/long, bearing and distance.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#distanceAndAngle-instance_method" title="#distanceAndAngle (instance method)">#<strong>distanceAndAngle</strong>(p2)  &#x21d2; TrackAndDistance </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Vincenty&#39;s algorithm for finding bearing and distance between to coordinates.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#sphereDestination-instance_method" title="#sphereDestination (instance method)">#<strong>sphereDestination</strong>(track_and_distance)  &#x21d2; Vincenty </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>spherical earth estimate of calculation for finding target coordinate from start coordinate, bearing and distance Used to run checks on the Vincenty algorithm.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#sphericalDistanceAndAngle-instance_method" title="#sphericalDistanceAndAngle (instance method)">#<strong>sphericalDistanceAndAngle</strong>(p2, equatorial_radius = WGS84_ER, inverse_flattening = WGS84_IF)  &#x21d2; TrackAndDistance </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Great Circle formulae <a href="http://en.wikipedia.org/wiki/Great-circle_distance">en.wikipedia.org/wiki/Great-circle_distance</a> Reference calculation for testing, assumes the earth is a sphere, which it isn&#39;t.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#version-instance_method" title="#version (instance method)">#<strong>version</strong>  &#x21d2; String </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Constant VERSION.</p>
</div></span>
  
</li>

      
    </ul>
  


  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods inherited from <span class='object_link'><a href="Coordinate.html" title="Coordinate (class)">Coordinate</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="Coordinate.html#initialize-instance_method" title="Coordinate#initialize (method)">#initialize</a></span>, <span class='object_link'><a href="Coordinate.html#to_ary-instance_method" title="Coordinate#to_ary (method)">#to_ary</a></span>, <span class='object_link'><a href="Coordinate.html#to_hash-instance_method" title="Coordinate#to_hash (method)">#to_hash</a></span>, <span class='object_link'><a href="Coordinate.html#to_s-instance_method" title="Coordinate#to_s (method)">#to_s</a></span></p>
<div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <p class="notice">This class inherits a constructor from <span class='object_link'><a href="Coordinate.html#initialize-instance_method" title="Coordinate#initialize (method)">Coordinate</a></span></p>
  
</div>


  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="destination-instance_method">
  
    #<strong>destination</strong>(track_and_distance)  &#x21d2; <tt><span class='object_link'><a href="" title="Vincenty (class)">Vincenty</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Calculate destination point given start point lat/long, bearing and distance. Assumes earth is a WGS-84 Ellipsod.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>specifying</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="TrackAndDistance.html" title="TrackAndDistance (class)">TrackAndDistance</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>bearing and distance.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="" title="Vincenty (class)">Vincenty</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>with the destination coordinates.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/vincenty.rb', line 159</span>

<span class='kw'>def</span> <span class='id identifier rubyid_destination'>destination</span><span class='lparen'>(</span> <span class='id identifier rubyid_track_and_distance'>track_and_distance</span> <span class='rparen'>)</span>
  <span class='comment'># a, b = major &amp; minor semiaxes of the ellipsoid
</span>  <span class='id identifier rubyid_a'>a</span> <span class='op'>=</span> <span class='int'>6378137</span> <span class='comment'># equatorial radius in meters     (+/-2 m)
</span>  <span class='id identifier rubyid_b'>b</span> <span class='op'>=</span> <span class='float'>6356752.31424518</span> <span class='comment'># polar radius in meters
</span>  <span class='id identifier rubyid_f'>f</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='id identifier rubyid_a'>a</span> <span class='op'>-</span> <span class='id identifier rubyid_b'>b</span><span class='rparen'>)</span> <span class='op'>/</span> <span class='id identifier rubyid_a'>a</span> <span class='comment'>#  flattening
</span>
  <span class='id identifier rubyid_s'>s</span> <span class='op'>=</span> <span class='id identifier rubyid_track_and_distance'>track_and_distance</span><span class='period'>.</span><span class='id identifier rubyid_distance'>distance</span><span class='period'>.</span><span class='id identifier rubyid_abs'>abs</span>
  <span class='id identifier rubyid_alpha1'>alpha1</span> <span class='op'>=</span> <span class='id identifier rubyid_track_and_distance'>track_and_distance</span><span class='period'>.</span><span class='id identifier rubyid_bearing'>bearing</span><span class='period'>.</span><span class='id identifier rubyid_to_rad'>to_rad</span>
  <span class='id identifier rubyid_sin_alpha1'>sin_alpha1</span> <span class='op'>=</span> <span class='const'>Math</span><span class='period'>.</span><span class='id identifier rubyid_sin'>sin</span><span class='lparen'>(</span><span class='id identifier rubyid_alpha1'>alpha1</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_cos_alpha1'>cos_alpha1</span> <span class='op'>=</span> <span class='const'>Math</span><span class='period'>.</span><span class='id identifier rubyid_cos'>cos</span><span class='lparen'>(</span><span class='id identifier rubyid_alpha1'>alpha1</span><span class='rparen'>)</span>

  <span class='id identifier rubyid_tanU1'>tanU1</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='int'>1</span> <span class='op'>-</span> <span class='id identifier rubyid_f'>f</span><span class='rparen'>)</span> <span class='op'>*</span> <span class='const'>Math</span><span class='period'>.</span><span class='id identifier rubyid_tan'>tan</span><span class='lparen'>(</span><span class='ivar'>@latitude</span><span class='period'>.</span><span class='id identifier rubyid_to_rad'>to_rad</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_cosU1'>cosU1</span> <span class='op'>=</span> <span class='int'>1</span> <span class='op'>/</span> <span class='const'>Math</span><span class='period'>.</span><span class='id identifier rubyid_sqrt'>sqrt</span><span class='lparen'>(</span><span class='lparen'>(</span><span class='int'>1</span> <span class='op'>+</span> <span class='id identifier rubyid_tanU1'>tanU1</span> <span class='op'>*</span> <span class='id identifier rubyid_tanU1'>tanU1</span><span class='rparen'>)</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_sinU1'>sinU1</span> <span class='op'>=</span> <span class='id identifier rubyid_tanU1'>tanU1</span> <span class='op'>*</span> <span class='id identifier rubyid_cosU1'>cosU1</span>
  <span class='id identifier rubyid_sigma1'>sigma1</span> <span class='op'>=</span> <span class='const'>Math</span><span class='period'>.</span><span class='id identifier rubyid_atan2'>atan2</span><span class='lparen'>(</span><span class='id identifier rubyid_tanU1'>tanU1</span><span class='comma'>,</span> <span class='id identifier rubyid_cos_alpha1'>cos_alpha1</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_sin_alpha'>sin_alpha</span> <span class='op'>=</span> <span class='id identifier rubyid_cosU1'>cosU1</span> <span class='op'>*</span> <span class='id identifier rubyid_sin_alpha1'>sin_alpha1</span>
  <span class='id identifier rubyid_cos_2_alpha'>cos_2_alpha</span> <span class='op'>=</span> <span class='int'>1</span> <span class='op'>-</span> <span class='id identifier rubyid_sin_alpha'>sin_alpha</span> <span class='op'>*</span> <span class='id identifier rubyid_sin_alpha'>sin_alpha</span> <span class='comment'># Trig identity
</span>  <span class='id identifier rubyid_u_2'>u_2</span> <span class='op'>=</span> <span class='id identifier rubyid_cos_2_alpha'>cos_2_alpha</span> <span class='op'>*</span> <span class='lparen'>(</span><span class='id identifier rubyid_a'>a</span> <span class='op'>*</span> <span class='id identifier rubyid_a'>a</span> <span class='op'>-</span> <span class='id identifier rubyid_b'>b</span> <span class='op'>*</span> <span class='id identifier rubyid_b'>b</span><span class='rparen'>)</span> <span class='op'>/</span> <span class='lparen'>(</span><span class='id identifier rubyid_b'>b</span> <span class='op'>*</span> <span class='id identifier rubyid_b'>b</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_a1'>a1</span> <span class='op'>=</span> <span class='int'>1</span> <span class='op'>+</span> <span class='id identifier rubyid_u_2'>u_2</span> <span class='op'>/</span> <span class='int'>16384</span> <span class='op'>*</span> <span class='lparen'>(</span><span class='int'>4096</span> <span class='op'>+</span> <span class='id identifier rubyid_u_2'>u_2</span> <span class='op'>*</span> <span class='lparen'>(</span><span class='op'>-</span><span class='int'>768</span> <span class='op'>+</span> <span class='id identifier rubyid_u_2'>u_2</span> <span class='op'>*</span> <span class='lparen'>(</span><span class='int'>320</span> <span class='op'>-</span> <span class='int'>175</span> <span class='op'>*</span> <span class='id identifier rubyid_u_2'>u_2</span><span class='rparen'>)</span><span class='rparen'>)</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_b1'>b1</span> <span class='op'>=</span> <span class='id identifier rubyid_u_2'>u_2</span> <span class='op'>/</span> <span class='int'>1024</span> <span class='op'>*</span> <span class='lparen'>(</span><span class='int'>256</span> <span class='op'>+</span> <span class='id identifier rubyid_u_2'>u_2</span> <span class='op'>*</span> <span class='lparen'>(</span><span class='op'>-</span><span class='int'>128</span> <span class='op'>+</span> <span class='id identifier rubyid_u_2'>u_2</span> <span class='op'>*</span> <span class='lparen'>(</span><span class='int'>74</span> <span class='op'>-</span> <span class='int'>47</span> <span class='op'>*</span> <span class='id identifier rubyid_u_2'>u_2</span><span class='rparen'>)</span><span class='rparen'>)</span><span class='rparen'>)</span>

  <span class='id identifier rubyid_sigma'>sigma</span> <span class='op'>=</span> <span class='id identifier rubyid_s'>s</span> <span class='op'>/</span> <span class='lparen'>(</span><span class='id identifier rubyid_b'>b</span> <span class='op'>*</span> <span class='id identifier rubyid_a1'>a1</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_sigma_dash'>sigma_dash</span> <span class='op'>=</span> <span class='int'>2</span> <span class='op'>*</span> <span class='const'>Math</span><span class='op'>::</span><span class='const'>PI</span>
  <span class='kw'>while</span> <span class='lparen'>(</span><span class='id identifier rubyid_sigma'>sigma</span> <span class='op'>-</span> <span class='id identifier rubyid_sigma_dash'>sigma_dash</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_abs'>abs</span> <span class='op'>&gt;</span> <span class='float'>1.0e-12</span> <span class='comment'># i.e 0.06mm
</span>    <span class='id identifier rubyid_cos_2_sigma_m'>cos_2_sigma_m</span> <span class='op'>=</span> <span class='const'>Math</span><span class='period'>.</span><span class='id identifier rubyid_cos'>cos</span><span class='lparen'>(</span><span class='int'>2</span> <span class='op'>*</span> <span class='id identifier rubyid_sigma1'>sigma1</span> <span class='op'>+</span> <span class='id identifier rubyid_sigma'>sigma</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_sin_sigma'>sin_sigma</span> <span class='op'>=</span> <span class='const'>Math</span><span class='period'>.</span><span class='id identifier rubyid_sin'>sin</span><span class='lparen'>(</span><span class='id identifier rubyid_sigma'>sigma</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_cos_sigma'>cos_sigma</span> <span class='op'>=</span> <span class='const'>Math</span><span class='period'>.</span><span class='id identifier rubyid_cos'>cos</span><span class='lparen'>(</span><span class='id identifier rubyid_sigma'>sigma</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_delta_sigma'>delta_sigma</span> <span class='op'>=</span> <span class='id identifier rubyid_b1'>b1</span> <span class='op'>*</span> <span class='id identifier rubyid_sin_sigma'>sin_sigma</span> <span class='op'>*</span> <span class='lparen'>(</span><span class='id identifier rubyid_cos_2_sigma_m'>cos_2_sigma_m</span> <span class='op'>+</span> <span class='id identifier rubyid_b1'>b1</span> <span class='op'>/</span> <span class='int'>4</span> <span class='op'>*</span> <span class='lparen'>(</span><span class='id identifier rubyid_cos_sigma'>cos_sigma</span> <span class='op'>*</span> <span class='lparen'>(</span><span class='op'>-</span><span class='int'>1</span> <span class='op'>+</span> <span class='int'>2</span> <span class='op'>*</span> <span class='id identifier rubyid_cos_2_sigma_m'>cos_2_sigma_m</span> <span class='op'>*</span> <span class='id identifier rubyid_cos_2_sigma_m'>cos_2_sigma_m</span><span class='rparen'>)</span> <span class='op'>-</span> <span class='id identifier rubyid_b1'>b1</span> <span class='op'>/</span> <span class='int'>6</span> <span class='op'>*</span> <span class='id identifier rubyid_cos_2_sigma_m'>cos_2_sigma_m</span> <span class='op'>*</span> <span class='lparen'>(</span><span class='op'>-</span><span class='int'>3</span> <span class='op'>+</span> <span class='int'>4</span> <span class='op'>*</span> <span class='id identifier rubyid_sin_sigma'>sin_sigma</span> <span class='op'>*</span> <span class='id identifier rubyid_sin_sigma'>sin_sigma</span><span class='rparen'>)</span> <span class='op'>*</span> <span class='lparen'>(</span><span class='op'>-</span><span class='int'>3</span> <span class='op'>+</span> <span class='int'>4</span> <span class='op'>*</span> <span class='id identifier rubyid_cos_2_sigma_m'>cos_2_sigma_m</span> <span class='op'>*</span> <span class='id identifier rubyid_cos_2_sigma_m'>cos_2_sigma_m</span><span class='rparen'>)</span><span class='rparen'>)</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_sigma_dash'>sigma_dash</span> <span class='op'>=</span> <span class='id identifier rubyid_sigma'>sigma</span>
    <span class='id identifier rubyid_sigma'>sigma</span> <span class='op'>=</span> <span class='id identifier rubyid_s'>s</span> <span class='op'>/</span> <span class='lparen'>(</span><span class='id identifier rubyid_b'>b</span> <span class='op'>*</span> <span class='id identifier rubyid_a1'>a1</span><span class='rparen'>)</span> <span class='op'>+</span> <span class='id identifier rubyid_delta_sigma'>delta_sigma</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_tmp'>tmp</span> <span class='op'>=</span> <span class='id identifier rubyid_sinU1'>sinU1</span> <span class='op'>*</span> <span class='id identifier rubyid_sin_sigma'>sin_sigma</span> <span class='op'>-</span> <span class='id identifier rubyid_cosU1'>cosU1</span> <span class='op'>*</span> <span class='id identifier rubyid_cos_sigma'>cos_sigma</span> <span class='op'>*</span> <span class='id identifier rubyid_cos_alpha1'>cos_alpha1</span>
  <span class='id identifier rubyid_lat2'>lat2</span> <span class='op'>=</span> <span class='const'>Math</span><span class='period'>.</span><span class='id identifier rubyid_atan2'>atan2</span><span class='lparen'>(</span><span class='id identifier rubyid_sinU1'>sinU1</span> <span class='op'>*</span> <span class='id identifier rubyid_cos_sigma'>cos_sigma</span> <span class='op'>+</span> <span class='id identifier rubyid_cosU1'>cosU1</span> <span class='op'>*</span> <span class='id identifier rubyid_sin_sigma'>sin_sigma</span> <span class='op'>*</span> <span class='id identifier rubyid_cos_alpha1'>cos_alpha1</span><span class='comma'>,</span> <span class='lparen'>(</span><span class='int'>1</span> <span class='op'>-</span> <span class='id identifier rubyid_f'>f</span><span class='rparen'>)</span> <span class='op'>*</span> <span class='const'>Math</span><span class='period'>.</span><span class='id identifier rubyid_sqrt'>sqrt</span><span class='lparen'>(</span><span class='id identifier rubyid_sin_alpha'>sin_alpha</span> <span class='op'>*</span> <span class='id identifier rubyid_sin_alpha'>sin_alpha</span> <span class='op'>+</span> <span class='id identifier rubyid_tmp'>tmp</span> <span class='op'>*</span> <span class='id identifier rubyid_tmp'>tmp</span><span class='rparen'>)</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_lambda_v'>lambda_v</span> <span class='op'>=</span> <span class='const'>Math</span><span class='period'>.</span><span class='id identifier rubyid_atan2'>atan2</span><span class='lparen'>(</span><span class='id identifier rubyid_sin_sigma'>sin_sigma</span> <span class='op'>*</span> <span class='id identifier rubyid_sin_alpha1'>sin_alpha1</span><span class='comma'>,</span> <span class='id identifier rubyid_cosU1'>cosU1</span> <span class='op'>*</span> <span class='id identifier rubyid_cos_sigma'>cos_sigma</span> <span class='op'>-</span> <span class='id identifier rubyid_sinU1'>sinU1</span> <span class='op'>*</span> <span class='id identifier rubyid_sin_sigma'>sin_sigma</span> <span class='op'>*</span> <span class='id identifier rubyid_cos_alpha1'>cos_alpha1</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_c'>c</span> <span class='op'>=</span> <span class='id identifier rubyid_f'>f</span> <span class='op'>/</span> <span class='int'>16</span> <span class='op'>*</span> <span class='id identifier rubyid_cos_2_alpha'>cos_2_alpha</span> <span class='op'>*</span> <span class='lparen'>(</span><span class='int'>4</span> <span class='op'>+</span> <span class='id identifier rubyid_f'>f</span> <span class='op'>*</span> <span class='lparen'>(</span><span class='int'>4</span> <span class='op'>-</span> <span class='int'>3</span> <span class='op'>*</span> <span class='id identifier rubyid_cos_2_alpha'>cos_2_alpha</span><span class='rparen'>)</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_l'>l</span> <span class='op'>=</span> <span class='id identifier rubyid_lambda_v'>lambda_v</span> <span class='op'>-</span> <span class='lparen'>(</span><span class='int'>1</span> <span class='op'>-</span> <span class='id identifier rubyid_c'>c</span><span class='rparen'>)</span> <span class='op'>*</span> <span class='id identifier rubyid_f'>f</span> <span class='op'>*</span> <span class='id identifier rubyid_sin_alpha'>sin_alpha</span> <span class='op'>*</span> <span class='lparen'>(</span><span class='id identifier rubyid_sigma'>sigma</span> <span class='op'>+</span> <span class='id identifier rubyid_c'>c</span> <span class='op'>*</span> <span class='id identifier rubyid_sin_sigma'>sin_sigma</span> <span class='op'>*</span> <span class='lparen'>(</span><span class='id identifier rubyid_cos_2_sigma_m'>cos_2_sigma_m</span> <span class='op'>+</span> <span class='id identifier rubyid_c'>c</span> <span class='op'>*</span> <span class='id identifier rubyid_cos_sigma'>cos_sigma</span> <span class='op'>*</span> <span class='lparen'>(</span><span class='op'>-</span><span class='int'>1</span> <span class='op'>+</span> <span class='int'>2</span> <span class='op'>*</span> <span class='id identifier rubyid_cos_2_sigma_m'>cos_2_sigma_m</span> <span class='op'>*</span> <span class='id identifier rubyid_cos_2_sigma_m'>cos_2_sigma_m</span><span class='rparen'>)</span><span class='rparen'>)</span><span class='rparen'>)</span> <span class='comment'># difference in longitude
</span>
  <span class='comment'># sigma2 = Math.atan2(sin_alpha, -tmp)  # reverse azimuth
</span>
  <span class='kw'>return</span> <span class='const'><span class='object_link'><a href="" title="Vincenty (class)">Vincenty</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="Coordinate.html#initialize-instance_method" title="Coordinate#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_lat2'>lat2</span><span class='comma'>,</span> <span class='ivar'>@longitude</span> <span class='op'>+</span> <span class='id identifier rubyid_l'>l</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='kw'>true</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="distanceAndAngle-instance_method">
  
    #<strong>distanceAndAngle</strong>(p2)  &#x21d2; <tt><span class='object_link'><a href="TrackAndDistance.html" title="TrackAndDistance (class)">TrackAndDistance</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Vincenty&#39;s algorithm for finding bearing and distance between to coordinates. Assumes earth is a WGS-84 Ellipsod.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>p2</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Coordinate.html" title="Coordinate (class)">Coordinate</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>is target coordinate that we want the bearing to.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="TrackAndDistance.html" title="TrackAndDistance (class)">TrackAndDistance</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>with the compass bearing and distance in meters to P2</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/vincenty.rb', line 64</span>

<span class='kw'>def</span> <span class='id identifier rubyid_distanceAndAngle'>distanceAndAngle</span><span class='lparen'>(</span> <span class='id identifier rubyid_p2'>p2</span> <span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_latitude'>latitude</span> <span class='op'>==</span> <span class='id identifier rubyid_p2'>p2</span><span class='period'>.</span><span class='id identifier rubyid_latitude'>latitude</span> <span class='op'>&amp;&amp;</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_longitude'>longitude</span> <span class='op'>==</span> <span class='id identifier rubyid_p2'>p2</span><span class='period'>.</span><span class='id identifier rubyid_longitude'>longitude</span>
    <span class='kw'>return</span> <span class='const'><span class='object_link'><a href="TrackAndDistance.html" title="TrackAndDistance (class)">TrackAndDistance</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="TrackAndDistance.html#initialize-instance_method" title="TrackAndDistance#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='int'>0</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='kw'>true</span><span class='rparen'>)</span> <span class='comment'># No calculations necessary. Solv NAN issue
</span>  <span class='kw'>end</span>

  <span class='comment'># a, b = major &amp; minor semiaxes of the ellipsoid
</span>  <span class='id identifier rubyid_a'>a</span> <span class='op'>=</span> <span class='int'>6378137</span> <span class='comment'># equatorial radius in meters     (+/-2 m)
</span>  <span class='id identifier rubyid_b'>b</span> <span class='op'>=</span> <span class='float'>6356752.31424518</span> <span class='comment'># polar radius in meters
</span>  <span class='id identifier rubyid_f'>f</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='id identifier rubyid_a'>a</span> <span class='op'>-</span> <span class='id identifier rubyid_b'>b</span><span class='rparen'>)</span> <span class='op'>/</span> <span class='id identifier rubyid_a'>a</span> <span class='comment'>#  flattening
</span>
  <span class='id identifier rubyid_lat1'>lat1</span> <span class='op'>=</span> <span class='ivar'>@latitude</span><span class='period'>.</span><span class='id identifier rubyid_to_rad'>to_rad</span>
  <span class='id identifier rubyid_lon1'>lon1</span> <span class='op'>=</span> <span class='ivar'>@longitude</span><span class='period'>.</span><span class='id identifier rubyid_to_rad'>to_rad</span>
  <span class='id identifier rubyid_lat2'>lat2</span> <span class='op'>=</span> <span class='id identifier rubyid_p2'>p2</span><span class='period'>.</span><span class='id identifier rubyid_latitude'>latitude</span><span class='period'>.</span><span class='id identifier rubyid_to_rad'>to_rad</span>
  <span class='id identifier rubyid_lon2'>lon2</span> <span class='op'>=</span> <span class='id identifier rubyid_p2'>p2</span><span class='period'>.</span><span class='id identifier rubyid_longitude'>longitude</span><span class='period'>.</span><span class='id identifier rubyid_to_rad'>to_rad</span>
  <span class='id identifier rubyid_lat1'>lat1</span> <span class='op'>=</span> <span class='id identifier rubyid_lat1'>lat1</span><span class='period'>.</span><span class='id identifier rubyid_sign'>sign</span> <span class='op'>*</span> <span class='lparen'>(</span><span class='const'>Math</span><span class='op'>::</span><span class='const'>PI</span> <span class='op'>/</span> <span class='int'>2</span> <span class='op'>-</span> <span class='float'>1e-10</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='lparen'>(</span><span class='const'>Math</span><span class='op'>::</span><span class='const'>PI</span> <span class='op'>/</span> <span class='int'>2</span> <span class='op'>-</span> <span class='id identifier rubyid_lat1'>lat1</span><span class='period'>.</span><span class='id identifier rubyid_abs'>abs</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_abs'>abs</span> <span class='op'>&lt;</span> <span class='float'>1.0e-10</span>
  <span class='id identifier rubyid_lat2'>lat2</span> <span class='op'>=</span> <span class='id identifier rubyid_lat2'>lat2</span><span class='period'>.</span><span class='id identifier rubyid_sign'>sign</span> <span class='op'>*</span> <span class='lparen'>(</span><span class='const'>Math</span><span class='op'>::</span><span class='const'>PI</span> <span class='op'>/</span> <span class='int'>2</span> <span class='op'>-</span> <span class='float'>1e-10</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='lparen'>(</span><span class='const'>Math</span><span class='op'>::</span><span class='const'>PI</span> <span class='op'>/</span> <span class='int'>2</span> <span class='op'>-</span> <span class='id identifier rubyid_lat2'>lat2</span><span class='period'>.</span><span class='id identifier rubyid_abs'>abs</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_abs'>abs</span> <span class='op'>&lt;</span> <span class='float'>1.0e-10</span>

  <span class='comment'>#  lat1, lat2 = geodetic latitude
</span>
  <span class='id identifier rubyid_l'>l</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='id identifier rubyid_lon2'>lon2</span> <span class='op'>-</span> <span class='id identifier rubyid_lon1'>lon1</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_abs'>abs</span> <span class='comment'># difference in longitude
</span>  <span class='id identifier rubyid_l'>l</span> <span class='op'>=</span> <span class='int'>2</span> <span class='op'>*</span> <span class='const'>Math</span><span class='op'>::</span><span class='const'>PI</span> <span class='op'>-</span> <span class='id identifier rubyid_l'>l</span> <span class='kw'>if</span> <span class='id identifier rubyid_l'>l</span> <span class='op'>&gt;</span> <span class='const'>Math</span><span class='op'>::</span><span class='const'>PI</span>
  <span class='id identifier rubyid_u1'>u1</span> <span class='op'>=</span> <span class='const'>Math</span><span class='period'>.</span><span class='id identifier rubyid_atan'>atan</span><span class='lparen'>(</span> <span class='lparen'>(</span> <span class='int'>1</span> <span class='op'>-</span> <span class='id identifier rubyid_f'>f</span><span class='rparen'>)</span> <span class='op'>*</span> <span class='const'>Math</span><span class='period'>.</span><span class='id identifier rubyid_tan'>tan</span><span class='lparen'>(</span> <span class='id identifier rubyid_lat1'>lat1</span> <span class='rparen'>)</span> <span class='rparen'>)</span> <span class='comment'># U is &#39;reduced latitude&#39;
</span>  <span class='id identifier rubyid_u2'>u2</span> <span class='op'>=</span> <span class='const'>Math</span><span class='period'>.</span><span class='id identifier rubyid_atan'>atan</span><span class='lparen'>(</span> <span class='lparen'>(</span> <span class='int'>1</span> <span class='op'>-</span> <span class='id identifier rubyid_f'>f</span><span class='rparen'>)</span> <span class='op'>*</span> <span class='const'>Math</span><span class='period'>.</span><span class='id identifier rubyid_tan'>tan</span><span class='lparen'>(</span> <span class='id identifier rubyid_lat2'>lat2</span> <span class='rparen'>)</span> <span class='rparen'>)</span>
  <span class='id identifier rubyid_sin_u1'>sin_u1</span> <span class='op'>=</span> <span class='const'>Math</span><span class='period'>.</span><span class='id identifier rubyid_sin'>sin</span><span class='lparen'>(</span><span class='id identifier rubyid_u1'>u1</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_cos_u1'>cos_u1</span> <span class='op'>=</span> <span class='const'>Math</span><span class='period'>.</span><span class='id identifier rubyid_cos'>cos</span><span class='lparen'>(</span><span class='id identifier rubyid_u1'>u1</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_sin_u2'>sin_u2</span> <span class='op'>=</span> <span class='const'>Math</span><span class='period'>.</span><span class='id identifier rubyid_sin'>sin</span><span class='lparen'>(</span><span class='id identifier rubyid_u2'>u2</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_cos_u2'>cos_u2</span> <span class='op'>=</span> <span class='const'>Math</span><span class='period'>.</span><span class='id identifier rubyid_cos'>cos</span><span class='lparen'>(</span><span class='id identifier rubyid_u2'>u2</span><span class='rparen'>)</span>

  <span class='id identifier rubyid_lambda_v'>lambda_v</span> <span class='op'>=</span> <span class='id identifier rubyid_l'>l</span>
  <span class='id identifier rubyid_lambda_dash'>lambda_dash</span> <span class='op'>=</span> <span class='const'>Math</span><span class='op'>::</span><span class='const'>PI</span> <span class='op'>*</span> <span class='int'>2</span>
  <span class='kw'>while</span> <span class='lparen'>(</span><span class='id identifier rubyid_lambda_v'>lambda_v</span> <span class='op'>-</span> <span class='id identifier rubyid_lambda_dash'>lambda_dash</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_abs'>abs</span> <span class='op'>&gt;</span> <span class='float'>1.0e-12</span>  <span class='comment'># i.e. 0.06 mm error
</span>    <span class='id identifier rubyid_sin_lambda_v'>sin_lambda_v</span> <span class='op'>=</span> <span class='const'>Math</span><span class='period'>.</span><span class='id identifier rubyid_sin'>sin</span><span class='lparen'>(</span><span class='id identifier rubyid_lambda_v'>lambda_v</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_cos_lambda_v'>cos_lambda_v</span> <span class='op'>=</span> <span class='const'>Math</span><span class='period'>.</span><span class='id identifier rubyid_cos'>cos</span><span class='lparen'>(</span><span class='id identifier rubyid_lambda_v'>lambda_v</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_sin_sigma'>sin_sigma</span> <span class='op'>=</span> <span class='const'>Math</span><span class='period'>.</span><span class='id identifier rubyid_sqrt'>sqrt</span><span class='lparen'>(</span> <span class='lparen'>(</span> <span class='id identifier rubyid_cos_u2'>cos_u2</span> <span class='op'>*</span> <span class='id identifier rubyid_sin_lambda_v'>sin_lambda_v</span> <span class='rparen'>)</span><span class='op'>**</span><span class='int'>2</span> <span class='op'>+</span> <span class='lparen'>(</span> <span class='id identifier rubyid_cos_u1'>cos_u1</span> <span class='op'>*</span> <span class='id identifier rubyid_sin_u2'>sin_u2</span> <span class='op'>-</span> <span class='id identifier rubyid_sin_u1'>sin_u1</span> <span class='op'>*</span> <span class='id identifier rubyid_cos_u2'>cos_u2</span> <span class='op'>*</span> <span class='id identifier rubyid_cos_lambda_v'>cos_lambda_v</span> <span class='rparen'>)</span><span class='op'>**</span><span class='int'>2</span> <span class='rparen'>)</span>
    <span class='id identifier rubyid_cos_sigma'>cos_sigma</span> <span class='op'>=</span> <span class='id identifier rubyid_sin_u1'>sin_u1</span> <span class='op'>*</span> <span class='id identifier rubyid_sin_u2'>sin_u2</span> <span class='op'>+</span> <span class='id identifier rubyid_cos_u1'>cos_u1</span> <span class='op'>*</span> <span class='id identifier rubyid_cos_u2'>cos_u2</span> <span class='op'>*</span> <span class='id identifier rubyid_cos_lambda_v'>cos_lambda_v</span>
    <span class='id identifier rubyid_sigma'>sigma</span> <span class='op'>=</span> <span class='const'>Math</span><span class='period'>.</span><span class='id identifier rubyid_atan2'>atan2</span><span class='lparen'>(</span><span class='id identifier rubyid_sin_sigma'>sin_sigma</span><span class='comma'>,</span> <span class='id identifier rubyid_cos_sigma'>cos_sigma</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_sin_alpha'>sin_alpha</span> <span class='op'>=</span> <span class='id identifier rubyid_cos_u1'>cos_u1</span> <span class='op'>*</span> <span class='id identifier rubyid_cos_u2'>cos_u2</span> <span class='op'>*</span> <span class='id identifier rubyid_sin_lambda_v'>sin_lambda_v</span> <span class='op'>/</span> <span class='id identifier rubyid_sin_sigma'>sin_sigma</span>
    <span class='id identifier rubyid_cos_2_alpha'>cos_2_alpha</span> <span class='op'>=</span> <span class='int'>1</span> <span class='op'>-</span> <span class='id identifier rubyid_sin_alpha'>sin_alpha</span> <span class='op'>*</span> <span class='id identifier rubyid_sin_alpha'>sin_alpha</span> <span class='comment'># trig identity
</span>    <span class='id identifier rubyid_cos_2_sigma_m'>cos_2_sigma_m</span> <span class='op'>=</span> <span class='id identifier rubyid_cos_sigma'>cos_sigma</span> <span class='op'>-</span> <span class='int'>2</span> <span class='op'>*</span> <span class='id identifier rubyid_sin_u1'>sin_u1</span> <span class='op'>*</span> <span class='id identifier rubyid_sin_u2'>sin_u2</span> <span class='op'>/</span> <span class='id identifier rubyid_cos_2_alpha'>cos_2_alpha</span>
    <span class='id identifier rubyid_c'>c</span> <span class='op'>=</span> <span class='id identifier rubyid_f'>f</span> <span class='op'>/</span> <span class='int'>16</span> <span class='op'>*</span> <span class='id identifier rubyid_cos_2_alpha'>cos_2_alpha</span> <span class='op'>*</span> <span class='lparen'>(</span><span class='int'>4</span> <span class='op'>+</span> <span class='id identifier rubyid_f'>f</span> <span class='op'>*</span> <span class='lparen'>(</span><span class='int'>4</span> <span class='op'>-</span> <span class='int'>3</span> <span class='op'>*</span> <span class='id identifier rubyid_cos_2_alpha'>cos_2_alpha</span><span class='rparen'>)</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_lambda_dash'>lambda_dash</span> <span class='op'>=</span> <span class='id identifier rubyid_lambda_v'>lambda_v</span>
    <span class='id identifier rubyid_lambda_v'>lambda_v</span> <span class='op'>=</span> <span class='id identifier rubyid_l'>l</span> <span class='op'>+</span> <span class='lparen'>(</span><span class='int'>1</span> <span class='op'>-</span> <span class='id identifier rubyid_c'>c</span><span class='rparen'>)</span> <span class='op'>*</span> <span class='id identifier rubyid_f'>f</span> <span class='op'>*</span> <span class='id identifier rubyid_sin_alpha'>sin_alpha</span> <span class='op'>*</span> <span class='lparen'>(</span><span class='id identifier rubyid_sigma'>sigma</span> <span class='op'>+</span> <span class='id identifier rubyid_c'>c</span> <span class='op'>*</span> <span class='id identifier rubyid_sin_sigma'>sin_sigma</span> <span class='op'>*</span> <span class='lparen'>(</span><span class='id identifier rubyid_cos_2_sigma_m'>cos_2_sigma_m</span> <span class='op'>+</span> <span class='id identifier rubyid_c'>c</span> <span class='op'>*</span> <span class='id identifier rubyid_cos_sigma'>cos_sigma</span> <span class='op'>*</span> <span class='lparen'>(</span><span class='op'>-</span><span class='int'>1</span> <span class='op'>+</span> <span class='int'>2</span> <span class='op'>*</span> <span class='id identifier rubyid_cos_2_sigma_m'>cos_2_sigma_m</span> <span class='op'>*</span> <span class='id identifier rubyid_cos_2_sigma_m'>cos_2_sigma_m</span><span class='rparen'>)</span> <span class='rparen'>)</span> <span class='rparen'>)</span>  <span class='comment'># use cos_2_sigma_m=0 when over equatorial lines
</span>    <span class='kw'>if</span> <span class='id identifier rubyid_lambda_v'>lambda_v</span> <span class='op'>&gt;</span> <span class='const'>Math</span><span class='op'>::</span><span class='const'>PI</span>
      <span class='id identifier rubyid_lambda_v'>lambda_v</span> <span class='op'>=</span> <span class='const'>Math</span><span class='op'>::</span><span class='const'>PI</span>
      <span class='kw'>break</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_u_2'>u_2</span> <span class='op'>=</span> <span class='id identifier rubyid_cos_2_alpha'>cos_2_alpha</span> <span class='op'>*</span> <span class='lparen'>(</span><span class='id identifier rubyid_a'>a</span> <span class='op'>*</span> <span class='id identifier rubyid_a'>a</span> <span class='op'>-</span> <span class='id identifier rubyid_b'>b</span> <span class='op'>*</span> <span class='id identifier rubyid_b'>b</span><span class='rparen'>)</span> <span class='op'>/</span> <span class='lparen'>(</span><span class='id identifier rubyid_b'>b</span> <span class='op'>*</span> <span class='id identifier rubyid_b'>b</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_a1'>a1</span> <span class='op'>=</span> <span class='int'>1</span> <span class='op'>+</span> <span class='id identifier rubyid_u_2'>u_2</span> <span class='op'>/</span> <span class='int'>16384</span> <span class='op'>*</span> <span class='lparen'>(</span><span class='int'>4096</span> <span class='op'>+</span> <span class='id identifier rubyid_u_2'>u_2</span> <span class='op'>*</span> <span class='lparen'>(</span><span class='op'>-</span><span class='int'>768</span> <span class='op'>+</span> <span class='id identifier rubyid_u_2'>u_2</span> <span class='op'>*</span> <span class='lparen'>(</span><span class='int'>320</span> <span class='op'>-</span> <span class='int'>175</span> <span class='op'>*</span> <span class='id identifier rubyid_u_2'>u_2</span><span class='rparen'>)</span><span class='rparen'>)</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_b1'>b1</span> <span class='op'>=</span> <span class='id identifier rubyid_u_2'>u_2</span> <span class='op'>/</span> <span class='int'>1024</span> <span class='op'>*</span> <span class='lparen'>(</span><span class='int'>256</span> <span class='op'>+</span> <span class='id identifier rubyid_u_2'>u_2</span> <span class='op'>*</span> <span class='lparen'>(</span><span class='op'>-</span><span class='int'>128</span> <span class='op'>+</span> <span class='id identifier rubyid_u_2'>u_2</span> <span class='op'>*</span> <span class='lparen'>(</span><span class='int'>74</span> <span class='op'>-</span> <span class='int'>47</span> <span class='op'>*</span> <span class='id identifier rubyid_u_2'>u_2</span><span class='rparen'>)</span><span class='rparen'>)</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_delta_sigma'>delta_sigma</span> <span class='op'>=</span> <span class='id identifier rubyid_b1'>b1</span> <span class='op'>*</span> <span class='id identifier rubyid_sin_sigma'>sin_sigma</span> <span class='op'>*</span> <span class='lparen'>(</span><span class='id identifier rubyid_cos_2_sigma_m'>cos_2_sigma_m</span> <span class='op'>+</span> <span class='id identifier rubyid_b1'>b1</span> <span class='op'>/</span> <span class='int'>4</span> <span class='op'>*</span> <span class='lparen'>(</span><span class='id identifier rubyid_cos_sigma'>cos_sigma</span> <span class='op'>*</span> <span class='lparen'>(</span><span class='op'>-</span><span class='int'>1</span> <span class='op'>+</span> <span class='int'>2</span> <span class='op'>*</span> <span class='id identifier rubyid_cos_2_sigma_m'>cos_2_sigma_m</span> <span class='op'>*</span> <span class='id identifier rubyid_cos_2_sigma_m'>cos_2_sigma_m</span><span class='rparen'>)</span> <span class='op'>-</span> <span class='id identifier rubyid_b1'>b1</span> <span class='op'>/</span> <span class='int'>6</span> <span class='op'>*</span> <span class='id identifier rubyid_cos_2_sigma_m'>cos_2_sigma_m</span> <span class='op'>*</span> <span class='lparen'>(</span><span class='op'>-</span><span class='int'>3</span> <span class='op'>+</span> <span class='int'>4</span> <span class='op'>*</span> <span class='id identifier rubyid_sin_sigma'>sin_sigma</span> <span class='op'>*</span> <span class='id identifier rubyid_sin_sigma'>sin_sigma</span><span class='rparen'>)</span> <span class='op'>*</span> <span class='lparen'>(</span><span class='op'>-</span><span class='int'>3</span> <span class='op'>+</span> <span class='int'>4</span> <span class='op'>*</span> <span class='id identifier rubyid_cos_2_sigma_m'>cos_2_sigma_m</span> <span class='op'>*</span> <span class='id identifier rubyid_cos_2_sigma_m'>cos_2_sigma_m</span><span class='rparen'>)</span><span class='rparen'>)</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_s'>s</span> <span class='op'>=</span> <span class='id identifier rubyid_b'>b</span> <span class='op'>*</span> <span class='id identifier rubyid_a1'>a1</span> <span class='op'>*</span> <span class='lparen'>(</span><span class='id identifier rubyid_sigma'>sigma</span> <span class='op'>-</span> <span class='id identifier rubyid_delta_sigma'>delta_sigma</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_sin_lambda_v'>sin_lambda_v</span> <span class='op'>=</span> <span class='const'>Math</span><span class='period'>.</span><span class='id identifier rubyid_sin'>sin</span><span class='lparen'>(</span><span class='id identifier rubyid_lambda_v'>lambda_v</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_cos_lambda_v'>cos_lambda_v</span> <span class='op'>=</span> <span class='const'>Math</span><span class='period'>.</span><span class='id identifier rubyid_cos'>cos</span><span class='lparen'>(</span><span class='id identifier rubyid_lambda_v'>lambda_v</span><span class='rparen'>)</span>

  <span class='comment'># This test isn&#39;t in original formulae, and fixes the problem of all angles returned being between 0 - PI (0-180)
</span>  <span class='comment'># Also converts the result to compass bearing, rather than the mathmatical anticlockwise angles.
</span>  <span class='id identifier rubyid_alpha_1'>alpha_1</span> <span class='op'>=</span> <span class='kw'>if</span> <span class='const'>Math</span><span class='period'>.</span><span class='id identifier rubyid_sin'>sin</span><span class='lparen'>(</span><span class='id identifier rubyid_p2'>p2</span><span class='period'>.</span><span class='id identifier rubyid_longitude'>longitude</span><span class='period'>.</span><span class='id identifier rubyid_to_rad'>to_rad</span> <span class='op'>-</span> <span class='ivar'>@longitude</span><span class='period'>.</span><span class='id identifier rubyid_to_rad'>to_rad</span><span class='rparen'>)</span> <span class='op'>&lt;</span> <span class='int'>0</span>
              <span class='const'>Math</span><span class='op'>::</span><span class='const'>PI</span> <span class='op'>*</span> <span class='int'>2</span> <span class='op'>-</span> <span class='const'>Math</span><span class='period'>.</span><span class='id identifier rubyid_atan2'>atan2</span><span class='lparen'>(</span> <span class='id identifier rubyid_cos_u2'>cos_u2</span> <span class='op'>*</span> <span class='id identifier rubyid_sin_lambda_v'>sin_lambda_v</span><span class='comma'>,</span> <span class='id identifier rubyid_cos_u1'>cos_u1</span> <span class='op'>*</span> <span class='id identifier rubyid_sin_u2'>sin_u2</span> <span class='op'>-</span> <span class='id identifier rubyid_sin_u1'>sin_u1</span> <span class='op'>*</span> <span class='id identifier rubyid_cos_u2'>cos_u2</span> <span class='op'>*</span> <span class='id identifier rubyid_cos_lambda_v'>cos_lambda_v</span><span class='rparen'>)</span>
            <span class='comment'># alpha_2 = Math::PI*2-Math.atan2(cos_u1 * sin_lambda_v, -sin_u1 * cos_u2 + cos_u1 * sin_u2 * cos_lambda_v)
</span>            <span class='kw'>else</span>
              <span class='const'>Math</span><span class='period'>.</span><span class='id identifier rubyid_atan2'>atan2</span><span class='lparen'>(</span> <span class='id identifier rubyid_cos_u2'>cos_u2</span> <span class='op'>*</span> <span class='id identifier rubyid_sin_lambda_v'>sin_lambda_v</span><span class='comma'>,</span> <span class='id identifier rubyid_cos_u1'>cos_u1</span> <span class='op'>*</span> <span class='id identifier rubyid_sin_u2'>sin_u2</span> <span class='op'>-</span> <span class='id identifier rubyid_sin_u1'>sin_u1</span> <span class='op'>*</span> <span class='id identifier rubyid_cos_u2'>cos_u2</span> <span class='op'>*</span> <span class='id identifier rubyid_cos_lambda_v'>cos_lambda_v</span><span class='rparen'>)</span>
              <span class='comment'># alpha_2 = Math.atan2(cos_u1 * sin_lambda_v, -sin_u1 * cos_u2 + cos_u1 * sin_u2 * cos_lambda_v)
</span>            <span class='kw'>end</span>

  <span class='comment'># Note that the bearing is a compass (i.e. clockwise) angle.
</span>  <span class='kw'>return</span> <span class='const'><span class='object_link'><a href="TrackAndDistance.html" title="TrackAndDistance (class)">TrackAndDistance</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="TrackAndDistance.html#initialize-instance_method" title="TrackAndDistance#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_alpha_1'>alpha_1</span><span class='comma'>,</span> <span class='id identifier rubyid_s'>s</span><span class='comma'>,</span> <span class='kw'>true</span><span class='rparen'>)</span> <span class='comment'># What to do with alpha_2?
</span><span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="sphereDestination-instance_method">
  
    #<strong>sphereDestination</strong>(track_and_distance)  &#x21d2; <tt><span class='object_link'><a href="" title="Vincenty (class)">Vincenty</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>spherical earth estimate of calculation for finding target coordinate from start coordinate, bearing and distance Used to run checks on the Vincenty algorithm</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>track_and_distance</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="TrackAndDistance.html" title="TrackAndDistance (class)">TrackAndDistance</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>specifying bearing and distance.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="" title="Vincenty (class)">Vincenty</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>with the destination coordinates.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


138
139
140
141
142
143
144
145
146
147
148
149
150
151
152</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/vincenty.rb', line 138</span>

<span class='kw'>def</span> <span class='id identifier rubyid_sphereDestination'>sphereDestination</span><span class='lparen'>(</span> <span class='id identifier rubyid_track_and_distance'>track_and_distance</span> <span class='rparen'>)</span>
  <span class='id identifier rubyid_a'>a</span> <span class='op'>=</span> <span class='int'>6378137</span> <span class='comment'># equatorial radius in meters     (+/-2 m)
</span>  <span class='id identifier rubyid_b'>b</span> <span class='op'>=</span> <span class='float'>6356752.31424518</span> <span class='comment'># polar radius in meters
</span>  <span class='id identifier rubyid_r'>r</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='id identifier rubyid_a'>a</span> <span class='op'>+</span> <span class='id identifier rubyid_b'>b</span><span class='rparen'>)</span> <span class='op'>/</span> <span class='int'>2</span> <span class='comment'># average diametre as a rough estimate for our tests.
</span>
  <span class='id identifier rubyid_d'>d</span> <span class='op'>=</span> <span class='id identifier rubyid_track_and_distance'>track_and_distance</span><span class='period'>.</span><span class='id identifier rubyid_distance'>distance</span><span class='period'>.</span><span class='id identifier rubyid_abs'>abs</span>
  <span class='id identifier rubyid_sin_dor'>sin_dor</span> <span class='op'>=</span> <span class='const'>Math</span><span class='period'>.</span><span class='id identifier rubyid_sin'>sin</span><span class='lparen'>(</span><span class='id identifier rubyid_d'>d</span> <span class='op'>/</span> <span class='id identifier rubyid_r'>r</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_cos_dor'>cos_dor</span> <span class='op'>=</span> <span class='const'>Math</span><span class='period'>.</span><span class='id identifier rubyid_cos'>cos</span><span class='lparen'>(</span><span class='id identifier rubyid_d'>d</span> <span class='op'>/</span> <span class='id identifier rubyid_r'>r</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_sin_lat1'>sin_lat1</span> <span class='op'>=</span> <span class='const'>Math</span><span class='period'>.</span><span class='id identifier rubyid_sin'>sin</span><span class='lparen'>(</span><span class='ivar'>@latitude</span><span class='period'>.</span><span class='id identifier rubyid_to_rad'>to_rad</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_cos_lat1'>cos_lat1</span> <span class='op'>=</span> <span class='const'>Math</span><span class='period'>.</span><span class='id identifier rubyid_cos'>cos</span><span class='lparen'>(</span><span class='ivar'>@latitude</span><span class='period'>.</span><span class='id identifier rubyid_to_rad'>to_rad</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_lat2'>lat2</span> <span class='op'>=</span> <span class='const'>Math</span><span class='period'>.</span><span class='id identifier rubyid_asin'>asin</span><span class='lparen'>(</span> <span class='id identifier rubyid_sin_lat1'>sin_lat1</span> <span class='op'>*</span> <span class='id identifier rubyid_cos_dor'>cos_dor</span> <span class='op'>+</span> <span class='id identifier rubyid_cos_lat1'>cos_lat1</span> <span class='op'>*</span> <span class='id identifier rubyid_sin_dor'>sin_dor</span> <span class='op'>*</span> <span class='const'>Math</span><span class='period'>.</span><span class='id identifier rubyid_cos'>cos</span><span class='lparen'>(</span><span class='id identifier rubyid_track_and_distance'>track_and_distance</span><span class='period'>.</span><span class='id identifier rubyid_bearing'>bearing</span><span class='period'>.</span><span class='id identifier rubyid_to_rad'>to_rad</span><span class='rparen'>)</span> <span class='rparen'>)</span>
  <span class='id identifier rubyid_lon2'>lon2</span> <span class='op'>=</span> <span class='ivar'>@longitude</span><span class='period'>.</span><span class='id identifier rubyid_to_rad'>to_rad</span> <span class='op'>+</span> <span class='const'>Math</span><span class='period'>.</span><span class='id identifier rubyid_atan2'>atan2</span><span class='lparen'>(</span><span class='const'>Math</span><span class='period'>.</span><span class='id identifier rubyid_sin'>sin</span><span class='lparen'>(</span><span class='id identifier rubyid_track_and_distance'>track_and_distance</span><span class='period'>.</span><span class='id identifier rubyid_bearing'>bearing</span><span class='period'>.</span><span class='id identifier rubyid_to_rad'>to_rad</span><span class='rparen'>)</span> <span class='op'>*</span> <span class='id identifier rubyid_sin_dor'>sin_dor</span> <span class='op'>*</span> <span class='id identifier rubyid_cos_lat1'>cos_lat1</span><span class='comma'>,</span> <span class='id identifier rubyid_cos_dor'>cos_dor</span> <span class='op'>-</span> <span class='id identifier rubyid_sin_lat1'>sin_lat1</span> <span class='op'>*</span> <span class='const'>Math</span><span class='period'>.</span><span class='id identifier rubyid_sin'>sin</span><span class='lparen'>(</span><span class='id identifier rubyid_lat2'>lat2</span><span class='rparen'>)</span><span class='rparen'>)</span>

  <span class='const'><span class='object_link'><a href="" title="Vincenty (class)">Vincenty</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="Coordinate.html#initialize-instance_method" title="Coordinate#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_lat2'>lat2</span><span class='comma'>,</span> <span class='id identifier rubyid_lon2'>lon2</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='kw'>true</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="sphericalDistanceAndAngle-instance_method">
  
    #<strong>sphericalDistanceAndAngle</strong>(p2, equatorial_radius = WGS84_ER, inverse_flattening = WGS84_IF)  &#x21d2; <tt><span class='object_link'><a href="TrackAndDistance.html" title="TrackAndDistance (class)">TrackAndDistance</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Great Circle formulae <a href="http://en.wikipedia.org/wiki/Great-circle_distance">en.wikipedia.org/wiki/Great-circle_distance</a> Reference calculation for testing, assumes the earth is a sphere, which it isn&#39;t. This gives us an approximation to verify Vincenty algorithm.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>p2</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Coordinate.html" title="Coordinate (class)">Coordinate</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>is target coordinate that we want the bearing to.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="TrackAndDistance.html" title="TrackAndDistance (class)">TrackAndDistance</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>with the compass bearing and distance in meters to P2</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/vincenty.rb', line 32</span>

<span class='kw'>def</span> <span class='id identifier rubyid_sphericalDistanceAndAngle'>sphericalDistanceAndAngle</span><span class='lparen'>(</span> <span class='id identifier rubyid_p2'>p2</span><span class='comma'>,</span> <span class='id identifier rubyid_equatorial_radius'>equatorial_radius</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="#WGS84_ER-constant" title="Vincenty::WGS84_ER (constant)">WGS84_ER</a></span></span><span class='comma'>,</span> <span class='id identifier rubyid_inverse_flattening'>inverse_flattening</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="#WGS84_IF-constant" title="Vincenty::WGS84_IF (constant)">WGS84_IF</a></span></span> <span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_latitude'>latitude</span> <span class='op'>==</span> <span class='id identifier rubyid_p2'>p2</span><span class='period'>.</span><span class='id identifier rubyid_latitude'>latitude</span> <span class='op'>&amp;&amp;</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_longitude'>longitude</span> <span class='op'>==</span> <span class='id identifier rubyid_p2'>p2</span><span class='period'>.</span><span class='id identifier rubyid_longitude'>longitude</span>
    <span class='kw'>return</span> <span class='const'><span class='object_link'><a href="TrackAndDistance.html" title="TrackAndDistance (class)">TrackAndDistance</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="TrackAndDistance.html#initialize-instance_method" title="TrackAndDistance#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='int'>0</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='kw'>true</span><span class='rparen'>)</span> <span class='comment'># No calculations necessary
</span>  <span class='kw'>end</span>

  <span class='id identifier rubyid_a'>a</span> <span class='op'>=</span> <span class='id identifier rubyid_equatorial_radius'>equatorial_radius</span> <span class='comment'># equatorial radius in meters     (+/-2 m)
</span>  <span class='id identifier rubyid_f'>f</span> <span class='op'>=</span> <span class='id identifier rubyid_inverse_flattening'>inverse_flattening</span>
  <span class='id identifier rubyid_b'>b</span> <span class='op'>=</span> <span class='id identifier rubyid_a'>a</span> <span class='op'>-</span> <span class='id identifier rubyid_a'>a</span> <span class='op'>/</span> <span class='id identifier rubyid_f'>f</span> <span class='comment'># WGS84 = 6356752.314245179 polar radius in meters
</span>  <span class='id identifier rubyid_r'>r</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='id identifier rubyid_a'>a</span> <span class='op'>+</span> <span class='id identifier rubyid_b'>b</span><span class='rparen'>)</span> <span class='op'>/</span> <span class='int'>2</span> <span class='comment'># average diametre as a rough estimate for our tests.
</span>
  <span class='id identifier rubyid_sin_lat1'>sin_lat1</span> <span class='op'>=</span> <span class='const'>Math</span><span class='period'>.</span><span class='id identifier rubyid_sin'>sin</span><span class='lparen'>(</span><span class='ivar'>@latitude</span><span class='period'>.</span><span class='id identifier rubyid_to_rad'>to_rad</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_sin_lat2'>sin_lat2</span> <span class='op'>=</span> <span class='const'>Math</span><span class='period'>.</span><span class='id identifier rubyid_sin'>sin</span><span class='lparen'>(</span><span class='id identifier rubyid_p2'>p2</span><span class='period'>.</span><span class='id identifier rubyid_latitude'>latitude</span><span class='period'>.</span><span class='id identifier rubyid_to_rad'>to_rad</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_cos_lat1'>cos_lat1</span> <span class='op'>=</span> <span class='const'>Math</span><span class='period'>.</span><span class='id identifier rubyid_cos'>cos</span><span class='lparen'>(</span><span class='ivar'>@latitude</span><span class='period'>.</span><span class='id identifier rubyid_to_rad'>to_rad</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_atan1_2'>atan1_2</span> <span class='op'>=</span> <span class='const'>Math</span><span class='period'>.</span><span class='id identifier rubyid_atan'>atan</span><span class='lparen'>(</span><span class='int'>1</span><span class='rparen'>)</span> <span class='op'>*</span> <span class='int'>2</span>
  <span class='id identifier rubyid_t1'>t1</span> <span class='op'>=</span> <span class='id identifier rubyid_cos_lat1'>cos_lat1</span> <span class='op'>*</span> <span class='const'>Math</span><span class='period'>.</span><span class='id identifier rubyid_cos'>cos</span><span class='lparen'>(</span><span class='id identifier rubyid_p2'>p2</span><span class='period'>.</span><span class='id identifier rubyid_latitude'>latitude</span><span class='period'>.</span><span class='id identifier rubyid_to_rad'>to_rad</span><span class='rparen'>)</span> <span class='op'>*</span> <span class='const'>Math</span><span class='period'>.</span><span class='id identifier rubyid_cos'>cos</span><span class='lparen'>(</span><span class='ivar'>@longitude</span><span class='period'>.</span><span class='id identifier rubyid_to_rad'>to_rad</span> <span class='op'>-</span> <span class='id identifier rubyid_p2'>p2</span><span class='period'>.</span><span class='id identifier rubyid_longitude'>longitude</span><span class='period'>.</span><span class='id identifier rubyid_to_rad'>to_rad</span><span class='rparen'>)</span> <span class='op'>+</span> <span class='id identifier rubyid_sin_lat1'>sin_lat1</span> <span class='op'>*</span> <span class='id identifier rubyid_sin_lat2'>sin_lat2</span>
  <span class='id identifier rubyid_angular_distance'>angular_distance</span> <span class='op'>=</span> <span class='const'>Math</span><span class='period'>.</span><span class='id identifier rubyid_atan'>atan</span><span class='lparen'>(</span><span class='op'>-</span><span class='id identifier rubyid_t1'>t1</span> <span class='op'>/</span> <span class='const'>Math</span><span class='period'>.</span><span class='id identifier rubyid_sqrt'>sqrt</span><span class='lparen'>(</span><span class='op'>-</span><span class='id identifier rubyid_t1'>t1</span> <span class='op'>*</span> <span class='id identifier rubyid_t1'>t1</span> <span class='op'>+</span> <span class='int'>1</span><span class='rparen'>)</span><span class='rparen'>)</span> <span class='op'>+</span> <span class='id identifier rubyid_atan1_2'>atan1_2</span> <span class='comment'># central angle in radians so we can calculate the arc length.
</span>
  <span class='id identifier rubyid_t2'>t2</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='id identifier rubyid_sin_lat2'>sin_lat2</span> <span class='op'>-</span> <span class='id identifier rubyid_sin_lat1'>sin_lat1</span> <span class='op'>*</span> <span class='const'>Math</span><span class='period'>.</span><span class='id identifier rubyid_cos'>cos</span><span class='lparen'>(</span><span class='id identifier rubyid_angular_distance'>angular_distance</span><span class='rparen'>)</span><span class='rparen'>)</span> <span class='op'>/</span> <span class='lparen'>(</span><span class='id identifier rubyid_cos_lat1'>cos_lat1</span> <span class='op'>*</span> <span class='const'>Math</span><span class='period'>.</span><span class='id identifier rubyid_sin'>sin</span><span class='lparen'>(</span><span class='id identifier rubyid_angular_distance'>angular_distance</span><span class='rparen'>)</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_bearing'>bearing</span> <span class='op'>=</span> <span class='kw'>if</span> <span class='const'>Math</span><span class='period'>.</span><span class='id identifier rubyid_sin'>sin</span><span class='lparen'>(</span><span class='id identifier rubyid_p2'>p2</span><span class='period'>.</span><span class='id identifier rubyid_longitude'>longitude</span><span class='period'>.</span><span class='id identifier rubyid_to_rad'>to_rad</span> <span class='op'>-</span> <span class='ivar'>@longitude</span><span class='period'>.</span><span class='id identifier rubyid_to_rad'>to_rad</span><span class='rparen'>)</span> <span class='op'>&lt;</span> <span class='int'>0</span>
              <span class='int'>2</span> <span class='op'>*</span> <span class='const'>Math</span><span class='op'>::</span><span class='const'>PI</span> <span class='op'>-</span> <span class='lparen'>(</span><span class='const'>Math</span><span class='period'>.</span><span class='id identifier rubyid_atan'>atan</span><span class='lparen'>(</span><span class='op'>-</span><span class='id identifier rubyid_t2'>t2</span> <span class='op'>/</span> <span class='const'>Math</span><span class='period'>.</span><span class='id identifier rubyid_sqrt'>sqrt</span><span class='lparen'>(</span><span class='op'>-</span><span class='id identifier rubyid_t2'>t2</span> <span class='op'>*</span> <span class='id identifier rubyid_t2'>t2</span> <span class='op'>+</span> <span class='int'>1</span><span class='rparen'>)</span><span class='rparen'>)</span> <span class='op'>+</span> <span class='id identifier rubyid_atan1_2'>atan1_2</span><span class='rparen'>)</span> <span class='comment'># Compass Bearing in radians (clockwise)
</span>            <span class='kw'>else</span>
              <span class='const'>Math</span><span class='period'>.</span><span class='id identifier rubyid_atan'>atan</span><span class='lparen'>(</span><span class='op'>-</span><span class='id identifier rubyid_t2'>t2</span> <span class='op'>/</span> <span class='const'>Math</span><span class='period'>.</span><span class='id identifier rubyid_sqrt'>sqrt</span><span class='lparen'>(</span><span class='op'>-</span><span class='id identifier rubyid_t2'>t2</span> <span class='op'>*</span> <span class='id identifier rubyid_t2'>t2</span> <span class='op'>+</span> <span class='int'>1</span><span class='rparen'>)</span><span class='rparen'>)</span> <span class='op'>+</span> <span class='id identifier rubyid_atan1_2'>atan1_2</span> <span class='comment'># Compass Bearing in radians (clockwise)
</span>            <span class='kw'>end</span>

  <span class='comment'># Note that the bearing is a compass angle. That is angles are positive clockwise.
</span>  <span class='kw'>return</span> <span class='const'><span class='object_link'><a href="TrackAndDistance.html" title="TrackAndDistance (class)">TrackAndDistance</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="TrackAndDistance.html#initialize-instance_method" title="TrackAndDistance#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_bearing'>bearing</span><span class='comma'>,</span> <span class='id identifier rubyid_angular_distance'>angular_distance</span> <span class='op'>*</span> <span class='id identifier rubyid_r'>r</span><span class='comma'>,</span> <span class='kw'>true</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="version-instance_method">
  
    #<strong>version</strong>  &#x21d2; <tt><span class='object_link'><a href="String.html" title="String (class)">String</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns constant VERSION.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="String.html" title="String (class)">String</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>constant VERSION</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


18
19
20</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/vincenty.rb', line 18</span>

<span class='kw'>def</span> <span class='id identifier rubyid_version'>version</span>
  <span class='const'><span class='object_link'><a href="#VERSION-constant" title="Vincenty::VERSION (constant)">VERSION</a></span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

      <div id="footer">
  Generated on Sun Oct 10 12:09:06 2021 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.26 (ruby-3.0.2).
</div>

    </div>
  </body>
</html>